import java.util.Random;

WorldMap wmap;
//LatLngs lls = new LatLngs();
ArrayList tweets1 = new ArrayList();
ArrayList tweets2 = new ArrayList();
ArrayList tweets3 = new ArrayList();
Random generator = new Random();
PFont myFont;
PFont myFont2;
Point currentCity = null;
String currentTweet = "";
ArrayList tweetMaster = new ArrayList();
float[][] theArray = {{10.3873369, -75.5196631},{53.34155999999999, -6.257346999999982},{53.543564, -113.490452},{50.9406645, 6.959911499999976},{40.8400969, 14.251635699999952},{4.784821000000001, 7.005452999999989},{19.0330488, 73.02966249999997},{31.631321, -8.012477999999987},{11.0168445, 76.95583209999995},{23.3440997, 85.30956200000003},{14.6133333, -90.53527780000002},{52.4829614, -1.8935920000000124},{10.7904833, 78.70467250000002},{34.810488, 117.32372499999997},{32.128818, 112.77195899999992},{10.3873369, -75.5196631},{33.718151, 73.06054700000004},{1.0456264, 104.03045350000002},{-27.4709331, 153.02350239999998},{-22.8270994, -43.054379400000016},{30.7333148, 76.7794179},{-5.45, 105.26666669999997},{29.868336, 121.54399000000001},{26.2567287, 73.01704419999999},{46.59019000000001, 125.10463700000003},{12.1363889, -86.2513889},{29.031673, 111.69849699999997},{-32.9507408, -60.66650010000001},{56.0012512, 92.8855896},{32.625478, 116.99993300000006},{9.9252007, 78.11977539999998},{26.147129, 91.73555110000007},{35.6072668, 140.10629070000005},{36.179852, 44.01610900000003},{37.3393857, -121.89495549999998},{47.921378, 106.90553999999997},{6.3625, 2.4255000000000564},{-4.350073, 15.307732299999998},{42.331427, -83.0457538},{26.89384, 112.57190000000003},{40.84231, 111.74884700000007},{26.224447, 78.17871100000002},{11.664325, 78.14601419999997},{-9.6662515, -35.735098300000004},{16.5061743, 80.6480153},{12.303534, 76.64611000000002},{51.533269, 46.03454899999997},{30.894348, 120.08682299999998},{22.8166667, 89.54999999999995},{10.0636111, -69.33472219999999},{31.7311292, -106.46256240000002},{-0.95373, 100.35199699999998},{3.043061, 101.44065709999995},{51.6600188, 39.19741049999993},{37.8666667, 32.48333330000003},{11.8333333, 13.149999999999977},{8.487495, 76.948623},{35.7666667, -5.7999999999999545},{37.5034138, 126.76603090000003},{-16.3988222, -71.5368861},{11.08192, 7.715956000000006},{15.4461002, 74.99868019999997},{21.481217, 109.11989900000003},{42.870022, 74.58788299999992},{24.479836, 118.08942000000002},{14.065, 100.64611109999998},{7.8941667, -72.50388889999999},{28.55386, 112.35518000000002},{42.1892407, 14.541722199999981},{6.137777799999999, 1.2124999999999773},{-22.7868246, -43.313106300000015},{47.8388, 35.13956699999994},{34.308159, 47.057320000000004},{30.209459, 67.01817299999993},{-16.49901, -68.14624800000001},{-7.981894, 112.62650299999996},{27.702871, 85.31824400000005},{31.340527, 119.82336299999997},{7.190708, 125.45534099999998},{36.706691, 119.16192999999998},{-4.05, 39.66666669999995},{13.512668, 2.112516000000028},{22.270715, 113.57672600000001},{31.3260152, 75.57618290000005},{30.3321838, -81.65565099999998},{19.27883, 72.87879199999998},{39.7683765, -86.15804229999998},{35.5500643, 118.82892979999997},{34.573262, 135.48299799999995},{51.7592485, 19.45598330000007},{27.908337, 116.77543500000002},{36.88414, 30.70562999999993},{10.3156992, 123.88543660000005},{25.684139, -100.25099899999998},{-16.5166667, -68.16666670000001},{7.688089, -5.030654000000027},{43.6932364, 5.437460399999964},{35.6969444, -0.6330556000000342},{59.33278809999999, 18.064488100000062},{20.2960587, 85.82453980000003},{25.1695114, 75.85398980000002},{34.7084139, 36.7073944},{36.81881, 10.165960000000041},{-22.7597631, -43.45155420000003},{50.06465009999999, 19.94497990000002},{-5.794478499999999, -35.21095309999998},{37.950197, 58.380223},{23.1416985, 120.25127279999992},{27.89381, 78.06813799999998},{-23.689584, -46.5647381},{56.9465363, 24.104850299999953},{0.5333333, 101.45000000000005},{12.104797, 15.044505999999956},{28.6352778, -106.08888890000003},{20.97, -89.62},{37.8043637, -122.2711137},{28.3670355, 79.43043809999995},{28.8315925, 78.77827639999998},{49.839683, 24.029717000000005},{-8.112, -79.02879999999999},{16.863794, -99.88161400000001},{52.3702157, 4.895167899999933},{39.9611755, -82.99879420000002},{28.390409, 36.57320000000004},{21.158964, -86.84593699999999},{-33.93264, 25.569950000000063},{27.622865, 113.85467599999993},{14.0833, -87.2167},{8.491655999999999, 4.544642000000067},{39.4702393, -0.37680490000002465},{-5.0892123, -42.801627499999995},{4.361698, 18.55597499999999},{41.09512, 121.12700399999994},{53.5355606, 49.40956870000002},{35.05171199999999, 118.34770700000001},{30.041822, 112.424664},{39.9117431, 127.54528849999997},{7.8941667, -72.50388889999999},{21.270702, 110.35938699999997},{-20.4435053, -54.64775909999997},{40.824418, 114.88754300000005},{22.1564699, -100.98554089999999},{37.97918, 23.716646999999966},{18.084061, -15.978420000000028},{-1.950106, 30.058768999999984},{37.3218778, 126.83088480000004},{-20.17219, 28.581159999999954},{19.2938306, 73.06583890000002},{21.8817964, -102.29127010000002},{38.873891, 115.46480599999995},{41.78376, 129.78359999999998},{44.988458, 126.04971499999999},{9.9333333, 8.883333300000004},{8.372155, -62.64386000000002},{38.2526647, -85.75845570000001},{17.992731, -76.79200900000001},{32.8031004, 130.70789109999998},{31.768318, 35.21371099999999},{33.955845, 116.79826500000001},{44.55165299999999, 129.63316899999995},{19.538988, -99.19328100000001},{45.814912, 15.97851449999996},{52.9399159, -73.5491361},{32.39421, 119.41296599999998},{-23.5316928, -46.789923199999976},{30.267153, -97.74306079999997},{5.1166667, 7.366666699999996},{-15.7861111, 35.00583329999995},{4.61175, 101.11350600000003},{43.243603, -79.88907499999999},{19.4207517, -98.94895710000003},{37.38263999999999, -5.9962950999999975},{38.11564, 13.361405900000022},{35.55, 45.43333329999996},{32.1937314, 112.10535849999997},{35.303004, 113.92679999999996},{26.75, 83.3666667},{21.2513844, 81.6296413},{49.8997541, -97.1374937},{36.617085, 101.77820799999995},{47.910483, 33.39178300000003},{21.27066, 40.41706799999997},{20.5930556, -100.39222219999999},{32.1166667, 20.06666670000004},{25.4333333, -100.98333330000003},{4.8142778, -75.69455829999998},{-23.655314, -46.5320878},{47.02685899999999, 28.84155099999998},{54.3214798, 48.38565040000003},{-13.9833333, 33.78333329999998},{45.0421487, 38.980640300000005},{37.2410864, 127.17755369999998},{6.9270786, 79.86124300000006},{-8.65629, 115.22209900000007},{11.558831, 104.91744500000004},{6.687119, -1.6219690000000355},{24.3666667, 88.60000000000002},{35.1495343, -90.0489801},{-7.11532, -34.86105120000002},{36.9910113, 127.92594970000005},{50.1114451, 8.680615399999965},{37.91441, 40.23062900000002},{51.1078852, 17.03853760000004},{56.8426093, 53.22444919999998},{-0.5021829999999999, 117.15380099999993},{34.6551456, 133.9195019},{36.8, 34.633333300000004},{19.700593, -101.186421},{35.5714621, 139.3731765},{-28.2538694, -68.71549749999997},{30.199652, 115.03852000000006},{36.6424341, 127.48903189999999},{29.0891857, -110.96132990000001},{26.7077972, 88.42748180000001},{-4.77867, 11.863640000000032},{31.035423, 112.19926499999997},{35.414864, 116.58725900000002},{40.127344, 124.38491299999998},{35.215893, 113.24182300000007},{27.994267, 120.69936699999994},{8.732999999999999, 77.70000000000005},{21.183008, 81.36186199999997},{20.6333333, -103.31666669999998},{20.030765, 110.32887299999993},{30.425541, 48.18905999999993},{24.8041667, -107.43111110000001},{41.6562873, -0.8765379000000166},{-21.25286, -50.645839000000024},{46.799923, 130.31891700000006},{55.86562739999999, -4.257222700000057},{32.6455704, -115.4453421},{35.46883, 44.39098000000001},{39.2903848, -76.61218930000001},{23.68721, 86.973343},{57.6301004, 39.86563109999997},{8.4542363, 124.63189769999997},{47.349935, 130.29810099999997},{37.3942527, 126.95682090000003},{9.9457876, 76.275443},{53.3563385, 83.76164990000007},{20.930679, 77.75871299999994},{34.596544, 119.22128199999997},{55.86562739999999, -4.257222700000057},{34.1547, 113.47251600000004},{29.580237, 105.05835200000001},{14.5176184, 121.05086449999999},{32.725409, -97.32084959999997},{35.2270869, -80.84312669999997},{42.257817, 118.88685599999997},{-34.76118230000001, -58.43024760000003},{34.7108344, 137.72612579999998},{51.92421599999999, 4.481775999999968},{-33.615768, -70.56964900000003},{43.1306915, 131.92382799999996},{41.269493, 123.17283799999996}};


// for typing at dialog
int leftmargin = 10;
int rightmargin = 20;
Boolean box1 = false;
Boolean box2 = false;
String buff1 = "";
String buff2 = "";
Boolean dialog = true;

// Master Colors
int[] k1 = {24, 128, 200};
int[] k2 = {110, 300, 100};
int[] k3 = {245, 128, 10};

// toggle display of tweets
int Obama;
int Romney;
int both;

// Get JSON from Twitter
void getTwitterData(String url, ArrayList tweets, int kuler[], int origin)
{
  XMLElement xml;
  xml = new XMLElement(this, url);
  wmap = new WorldMap();
  int numTweets = xml.getChildCount();
  for (int i = 0; i<numTweets; i++){
    XMLElement kid = xml.getChild(i);
    XMLElement txtNode = kid.getChild("text");
    XMLElement userNode = kid.getChild("user");
    XMLElement screenNameNode = userNode.getChild("screen_name");
    int cityInt = generator.nextInt(255);
    float lat = ((float)theArray[cityInt][0]);
    float lng = ((float)theArray[cityInt][1]);
    ArrayList tempArr = new ArrayList();
    tempArr.add(wmap.getPoint(lat, lng));
    tempArr.add(origin);
    tempArr.add(txtNode.getContent());
    tempArr.add(kuler);
    tempArr.add(screenNameNode.getContent());
    tweets.add(tempArr);
  }
}

void buildMasterList(ArrayList twts){
    for (int i=0; i<twts.size(); i++){
    tweetMaster.add((ArrayList)twts.get(i));
    }
}

void makeKey(String term1, String term2){
  if(Obama == 1){
    fill((int)k1[0], (int)k1[1], (int)k1[2]);
  } else {
    fill(80);
  }
  rect((width/6) * 2 -20, 6, 16, 16);
  
  if(Romney==1){
    fill((int)k2[0], (int)k2[1], (int)k2[2]);
  } else {
    fill(80);
  }
  rect((width/6) * 3 -20, 6, 16, 16);
  if(both==1){
    fill((int)k3[0], (int)k3[1], (int)k3[2]);
  } else {
    fill(80);
  }
  rect((width/6) * 4 -20, 6, 16, 16);
  fill(230);
  text(term1, (width/6) * 2, 20);
  text(term2, (width/6) * 3, 20);
  text(term1 + " + " + term2, (width/6) * 4, 20);
}
void setup() {
  // Uncomment the following two lines to see the available fonts 
//  String[] fontList = PFont.list();
//  println(fontList);
  myFont = createFont("Helvetica-Bold", 12);
  myFont2 = createFont("Helvetica-Bold", 38);
  Obama = 1;
  Romney = 1;
  both = 1;
  textFont(myFont);
  size(1000, 500);
  ellipseMode(CENTER);
  fill(24, 128, 200);
  getTwitterData("twitteroutput/twitter.xml", tweets1, k1, 1);
  getTwitterData("twitteroutput/twitter2.xml", tweets2, k2, 2);
  getTwitterData("twitteroutput/twitter3.xml", tweets3,  k3, 3);
  buildMasterList(tweets1);
  buildMasterList(tweets2);
  buildMasterList(tweets3);
  smooth();
}

void handleMouse(ArrayList tweetMaster) {
  for(int i=0; i<tweetMaster.size(); i++){
    ArrayList tweet = (ArrayList)tweetMaster.get(i);
    Point city = (Point)tweet.get(0);
    int origin =  (Integer)tweet.get(1);
    int k[] = (int[])tweet.get(3);
    if(((origin == 1) && Obama != 1) || ((origin == 2) && Romney != 1) || ((origin == 3) && both != 1)){ } else {
      fill((int)k[0], (int)k[1], (int)k[2]);
      if (
          ( mouseX > (city.x -4)
            && mouseX < (city.x +4)
            && mouseY > (city.y -4)
            && mouseY < (city.y + 4)
           ) && currentCity == null)
           {
            currentCity = city;
            ellipse(currentCity.x, currentCity.y, 14, 14);
            currentTweet = "@" + (String)tweet.get(4) + "\n" + (String)tweet.get(2);
            } else {
            ellipse(city.x, city.y, 9, 9);
          }
      }
    }
      if(currentCity != null){
        fill(10);
        stroke(45);
        int xPos=mouseX, yPos=mouseY, tweetY=mouseY+10, tweetX = mouseX+10;
        if(mouseX > (width/2)){
          xPos = mouseX - 250;
          tweetX = xPos + 10;
        }
        if(mouseY > (height/2)){
          yPos = mouseY - 110;
          tweetY = yPos + 10;
        }
        rect(xPos, yPos, 240, 100);
        fill(200);
        noStroke();
        text(currentTweet, tweetX, tweetY, 220, 80);
        currentCity = null;
      }
  }

void draw() {
  noStroke();
  if(!dialog){
    wmap.drawBackground();
    handleMouse(tweetMaster);
    textAlign(LEFT);
    textFont(myFont);
    makeKey("Obama", "Romney");
  } else {
    background(20);
    textFont(myFont2);
    fill(180);
    if(box1){
      fill(100);
    }
    rect(200, height / 2 - 160, width -400, 80);
    fill(180);
    if(box2){
      fill(100);
    }
    rect(200, height / 2 - 40, width -400, 80);
    fill(180);
    rect(200, height / 2 + 80, width -400, 80);
    fill(100);
    textAlign(LEFT);
    text("Search Term One", 200, height / 2 - 160);
    text("Search Term Two", 200, height / 2 - 40);
    textAlign(CENTER);
    text("GO", width/2, height / 2 + 140);
    fill(20);
    textAlign(CENTER);
    if(buff1 != ""){
      text(buff1, width/2, height / 2 - 100);
    }
     if(buff2 != "") {
      text(buff2, width/2, height / 2 +20);
    }
  }
}



//key down event
void keyPressed()
{
  char k;
  k = (char)key;
  println("pressed: " + (int)k);
  switch(k) {
  case 8:
    if (buff1.length()>0) {
      buff1 = buff1.substring(0, buff1.length() - 1);
    }
    if (buff2.length()>0) {
      buff2 = buff2.substring(0, buff2.length() - 1);
    }
    break;
  case 13:  // Avoid special keys
  case 10:
  case 65535:
  case 127:
  case 27:
    break;
  default:
    if(box1){
      buff1=buff1+k;
    } else if (box2){
      buff2=buff2+k;
    }
    break;
  }
}

void toggleItem(int item){
  item = item * -1;
  println(item);
}

void mousePressed(){
//    rect(200, height / 2 - 160, width -400, 80);
//    rect(200, height / 2 - 40, width -400, 80);
//    rect(200, height / 2 + 80, width -400, 80);
  if(dialog){
  if(mouseX > 200 && mouseX < (200 + (width-400))){
    if((mouseY > height / 2 - 160) && (mouseY < height/2 - 80)){
      box1 = true;
      box2 = false;
    } else if((mouseY > height / 2 - 40) && (mouseY < height/2 + 40)){
      box2 = true;
      box1 = false;
    } else if((mouseY > height / 2 + 80) && (mouseY < height/2 + 160)){
      dialog = false;
      box1 = false;
      box2 = false;
    }
  }
  }
//  rect((width/6) * 2 -20, 6, 16, 16);
//  rect((width/6) * 3 -20, 6, 16, 16);
//  rect((width/6) * 4 -20, 6, 16, 16);
  if (!dialog) {
    if (mouseY > 6 && mouseY < 20){
      if ((mouseX > (width/6) *2 - 20) && (mouseX < (width/6) *2 - 4)){
        Obama = Obama * -1;
      } else if ((mouseX > (width/6) *3 - 20) && (mouseX < (width/6) *3 - 4)){
        Romney = Romney * -1;
      } else if ((mouseX > (width/6) *4 - 20) && (mouseX < (width/6) *4 - 4)){
        both = both * -1;
      }
    }
  }
}
